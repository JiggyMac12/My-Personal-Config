"use strict";var m=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var b=Object.getOwnPropertyNames;var x=Object.prototype.hasOwnProperty;var P=(a,t)=>{for(var o in t)m(a,o,{get:t[o],enumerable:!0})},A=(a,t,o,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let e of b(t))!x.call(a,e)&&e!==o&&m(a,e,{get:()=>t[e],enumerable:!(i=f(t,e))||i.enumerable});return a};var v=a=>A(m({},"__esModule",{value:!0}),a);var X={};P(X,{default:()=>S});module.exports=v(X);var p=require("child_process"),h=require("util"),s=(0,h.promisify)(p.exec);function y(a,t){let o=new Map;for(let i of a){let e=t(i),c=o.get(e);c?c.push(i):o.set(e,[i])}return Array.from(o.keys()).map(i=>({key:i,values:o.get(i)??[]}))}var w=require("@raycast/api"),l=class{static get bundleIdentifier(){return"com.apple.dt.Xcode"}static get downloadUrl(){return"https://apps.apple.com/app/id497799835"}static get developerDocumentationURLScheme(){return"x-xcode-documentation://"}static async isXcodeInstalled(){return!!(await(0,w.getApplications)()).find(o=>o.bundleId===l.bundleIdentifier)}static async isXcodeRunning(){try{return(await s("pgrep Xcode")).stdout.trim().length!==0}catch{return!1}}static launchXcode(){return s([`open -j -b ${l.bundleIdentifier}`,"sleep 2"].join(" && ")).then()}};var u=class extends Error{constructor(o){super(o);this.reason=o}};var r=class{static launchSimulatorApplication(){return s('open -b "com.apple.iphonesimulator"').then()}static async xcodeSimulatorGroups(t){let o=await r.xcodeSimulators();return y(o.filter(i=>t==="All"||i.state===t),i=>i.runtime).map(i=>({runtime:i.key,simulators:i.values})).sort((i,e)=>i.runtime.localeCompare(e.runtime))}static async xcodeSimulators(){let t=await s("xcrun simctl list -j -v devices"),o=JSON.parse(t.stdout);if(!o||!o.devices)throw[];let i=[];for(let e in o.devices){let c=e.substring(e.lastIndexOf(".")+1).split("-"),g=[c.shift(),c.join(".")].join(" ");i.push(...o.devices[e].map(d=>(d.runtime=g,d)))}return i}static boot(t){return s(`xcrun simctl boot ${t.udid}`).then(()=>{r.launchSimulatorApplication()})}static shutdown(t){return s(`xcrun simctl shutdown ${t.udid}`).then()}static toggle(t){switch(t.state){case"Booted":return r.shutdown(t);case"Shutting Down":return Promise.resolve();case"Shutdown":return r.boot(t)}}static async restart(t){await r.shutdown(t),await r.boot(t)}static async app(t,o,i){try{await r.boot(i)}catch{}return s(["xcrun","simctl",t,i.udid,o].join(" ")).then()}static async appPrivacy(t,o,i,e){try{await r.boot(e)}catch{}return s(["xcrun","simctl","privacy",e.udid,t,o,i].join(" ")).then()}static isValidUrl(t){return/\w+:\/\/+/.test(t)}static async openUrl(t,o){let i=t.trim();if(!r.isValidUrl(i))throw new u("Bad Url");if(!o){if(!await l.isXcodeInstalled())throw new u("Xcode is not installed");if(!(await r.xcodeSimulators()).some(c=>c.state==="Booted"))throw new u("No simulator booted")}return s(["xcrun","simctl","openurl",o?.udid??"booted",i].join(" ")).then(()=>{r.launchSimulatorApplication()})}static async sendPushNotification(t,o,i){return s(`xcrun simctl push ${t.udid} ${o} ${i}`).then()}static async rename(t,o){return s(`xcrun simctl rename ${t.udid} '${o}' `).then()}static async triggerIcloudSync(t){return s(`xcrun simctl icloud_sync ${t.udid}`).then()}};var n=require("@raycast/api");var S=async a=>{let t=await(0,n.showToast)({style:n.Toast.Style.Animated,title:"Opening URL in Simulator"});try{await r.openUrl(a.arguments.url),await(0,n.closeMainWindow)()}catch(o){if(o instanceof u)switch(o.reason){case"Bad Url":t.style=n.Toast.Style.Failure,t.title="Please enter a valid url";break;case"No simulator booted":t.style=n.Toast.Style.Failure,t.title="No simulator is booted, please boot a simulator to open a url.",t.primaryAction={title:"Manage Simulators",onAction:async i=>{await(0,n.launchCommand)({name:"manage-simulators.command",type:n.LaunchType.UserInitiated}),await i.hide()}};break;case"Xcode is not installed":await t.hide(),await(0,n.launchCommand)({name:"manage-simulators.command",type:n.LaunchType.UserInitiated});break}else t.style=n.Toast.Style.Failure,t.title="An error occurred while trying to open the url",t.message=`${o}`}};
